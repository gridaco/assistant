<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
  href="https://fonts.googleapis.com/css?family=Roboto:400,100,300,100italic,300italic,400italic,500italic,500,700,700italic,900,900italic"
  rel="stylesheet"
  type="text/css"
/>
<link
  href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@300;400&display=swap"
  rel="stylesheet"
/>

<!-- preconnection to warm up connection -->
<link rel="dns-prefetch" href="https://assistant-serve.grida.co/" />
<link rel="preconnect" href="https://assistant-serve.grida.co/init-figma" />
<link rel="preload" href="https://assistant-serve.grida.co/init-figma" />

<style>
  /* override ua stylesheet - figma lite is just a wrapper of web, it should not have any styles. */
  body {
    margin: 0px;
  }
  #resize-knob {
    position: fixed;
    right: 1px;
    bottom: 2px;
    cursor: nwse-resize;
  }

  #loader {
    border: 16px solid #f3f3f3; /* Light grey */
    border-top: 16px solid #3498db; /* Blue */
    border-radius: 50%;
    width: 120px;
    height: 120px;
    animation: spin 2s linear infinite;
  }

  @keyframes spin {
    0% {
      transform: rotate(0deg);
    }
    100% {
      transform: rotate(360deg);
    }
  }
</style>
<div id="main">
  <div id="loader"></div>
  <iframe
    z-index="1"
    id="remote-host"
    width="100%"
    height="100%"
    sandbox="allow-scripts allow-same-origin allow-popups"
    frameborder="0"
    allowfullscreen
    src="<%= htmlWebpackPlugin.options.host %>/init-figma"
  ></iframe>
  <svg
    id="resize-knob"
    width="16"
    height="16"
    viewBox="0 0 16 16"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path d="M16 0V16H0L16 0Z" fill="white" />
    <path d="M6.22577 16H3L16 3V6.22576L6.22577 16Z" fill="#8C8C8C" />
    <path
      d="M11.8602 16H8.63441L16 8.63441V11.8602L11.8602 16Z"
      fill="#8C8C8C"
    />
  </svg>
</div>
<script>
  const corner = document.getElementById("resize-knob");
  function resizeWindow(e) {
    const size = {
      w: Math.max(50, Math.floor(e.clientX + 5)),
      h: Math.max(50, Math.floor(e.clientY + 5)),
    };
    parent.postMessage({ pluginMessage: { type: "resize", size: size } }, "*");
  }
  corner.onpointerdown = (e) => {
    corner.onpointermove = resizeWindow;
    corner.setPointerCapture(e.pointerId);
  };
  corner.onpointerup = (e) => {
    corner.onpointermove = null;
    corner.releasePointerCapture(e.pointerId);
  };
</script>
<script>
  const frame = document.getElementById("remote-host");
  window.addEventListener("message", (event) => {
    // console.log("event recievd from lite-fima-app", event.data);
    if (event.data == "plugin-app-initialized") {
      // handle skeleton hide & initial load animation here.
      document.getElementById("loader").remove();
    }

    if ("pluginMessage" in event.data) {
      if (event.data.pluginMessage.__proxy_request_from_hosted_plugin) {
        handle(event.data.pluginMessage);
        return;
      }
      if (
        "pluginId" in event.data ||
        event.data.pluginMessage.type === "response"
      ) {
        frame.contentWindow.postMessage(event.data, "*");
      } else {
        parent.postMessage(
          {
            ...event.data,
            "message-transport": true,
          },
          "*"
        );
      }
    }
  });

  ///
  /// To optimize this package, we don't import any other dependency.
  /// but for a reference, please add import statement below with commented.
  ///
  /*import {*/
  /* TransportPluginEvent,*/
  /* PLUGIN_SDK_EK_BROWSER_OPEN_URI,*/
  /*} from "@plugin-sdk/core";*/
  function handleProxy(payload) {
    console.log("handling proxy request from hosted app.", payload);

    // PLUGIN_SDK_EK_BROWSER_OPEN_URI
    if (payload.key == "assistant/browser-api/open-uri") {
      open(payload.data.uri);
    }
  }
  ///
  ///
</script>
